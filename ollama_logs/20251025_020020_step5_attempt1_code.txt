from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

wait = WebDriverWait(driver, 15)

# Fill Email Address
try:
    email_input = wait.until(EC.element_to_be_clickable((By.ID, "input-10")))
    driver.execute_script("arguments[0].scrollIntoView({block: 'center'});", email_input)
    email_input.clear()
    email_input.send_keys(resume_data["email"])
    print("✓ Filled Email Address")
except Exception as e:
    print(f"✗ Failed to fill Email Address: {e}")

# Fill Password
try:
    password_input = wait.until(EC.element_to_be_clickable((By.ID, "input-11")))
    driver.execute_script("arguments[0].scrollIntoView({block: 'center'});", password_input)
    password_input.clear()
    password_input.send_keys(resume_data["password"])
    print("✓ Filled Password")
except Exception as e:
    print(f"✗ Failed to fill Password: {e}")

# Click the appropriate "Sign In" button within the login form
clicked = False
# Strategy 1: button inside form with text 'Sign In'
try:
    sign_in_btn = wait.until(EC.element_to_be_clickable(
        (By.XPATH, "//form//button[contains(text(),'Sign In') or @type='submit'][1]")))
    driver.execute_script("arguments[0].scrollIntoView({block: 'center'});", sign_in_btn)
    time.sleep(0.5)
    try:
        sign_in_btn.click()
        print("✓ Clicked Sign In button (normal click)")
    except Exception:
        driver.execute_script("arguments[0].click();", sign_in_btn)
        print("✓ Clicked Sign In button (JS click)")
    clicked = True
except Exception:
    pass

# Strategy 2: any visible button with class containing 'css-1ru62dj' or 'css-wkqt22'
if not clicked:
    try:
        sign_in_btn = wait.until(EC.element_to_be_clickable(
            (By.CSS_SELECTOR, "button.css-1ru62dj, button.css-wkqt22")))
        driver.execute_script("arguments[0].scrollIntoView({block: 'center'});", sign_in_btn)
        time.sleep(0.5)
        driver.execute_script("arguments[0].click();", sign_in_btn)
        print("✓ Clicked Sign In button (JS via CSS selector)")
        clicked = True
    except Exception:
        pass

# Strategy 3: fallback to any element containing text 'Sign In'
if not clicked:
    try:
        sign_in_elem = wait.until(EC.element_to_be_clickable(
            (By.XPATH, "//*[contains(text(),'Sign In')][1]")))
        driver.execute_script("arguments[0].scrollIntoView({block: 'center'});", sign_in_elem)
        time.sleep(0.5)
        driver.execute_script("arguments[0].click();", sign_in_elem)
        print("✓ Clicked Sign In element by text (JS click)")
    except Exception as e:
        print(f"✗ Could not click any Sign In button: {e}")

time.sleep(2)  # allow any post-login processing