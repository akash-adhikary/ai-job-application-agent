
def safe_click(elem):
    try:
        safe_click(elem)
    except Exception as e:
        print(f"⚠️ Normal click failed ({e}), trying via JavaScript.")
        driver.execute_script("arguments[0].click();", elem)

old_url = driver.current_url

# Fill email and password fields
try:
    email_elem = wait.until(EC.presence_of_element_located((
        By.XPATH,
        "//input[contains(translate(@name,'EMAIL','email'),'email') or "
        "contains(translate(@id,'EMAIL','email'),'email') or "
        "@type='email' or "
        "contains(@placeholder,'email') or "
        "contains(@aria-label,'email')]"
    )))
    driver.execute_script("arguments[0].scrollIntoView(true);", email_elem)
    email_elem.clear()
    email_elem.send_keys(EMAIL)
    password_elem = wait.until(EC.presence_of_element_located((
        By.XPATH,
        "//input[@type='password' or contains(translate(@name,'PASSWORD','password'),'password') or "
        "contains(translate(@id,'PASSWORD','password'),'password') or "
        "contains(@placeholder,'password') or "
        "contains(@aria-label,'password')]"
    )))
    driver.execute_script("arguments[0].scrollIntoView(true);", password_elem)
    password_elem.clear()
    password_elem.send_keys(PASSWORD)
    print("Filled email and password fields.")
except Exception as e:
    print(f"Error filling credentials: {e}")

# Click Sign‑In button
try:
    sign_in_btn = wait.until(EC.element_to_be_clickable((
        By.XPATH,
        "//button[normalize-space()='Sign In' or contains(.,'Sign In')] | "
        "//input[@type='submit' and (contains(@value,'Sign In') or contains(@aria-label,'Sign In'))]"
    )))
    driver.execute_script("arguments[0].scrollIntoView(true);", sign_in_btn)
    try:
        safe_click(sign_in_btn)
    except Exception:
        driver.execute_script("arguments[0].click();", sign_in_btn)
    print("Clicked Sign‑In button.")
except Exception as e:
    print(f"Error clicking Sign‑In button: {e}")

# Wait for URL to change after login
try:
    wait.until(lambda d: d.current_url != old_url)
    print("Login successful, URL changed.")
except Exception:
    print("Login attempted, but URL did not change.")