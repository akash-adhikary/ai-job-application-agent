from selenium.webdriver.common.by import By
from selenium.common.exceptions import NoSuchElementException, TimeoutException
import time

# Helper to fill a text input
def fill_input(by, locator, value, description):
    try:
        elem = WebDriverWait(driver, 10).until(
            EC.visibility_of_element_located((by, locator))
        )
        elem.clear()
        elem.send_keys(value)
        print(f"Filling field {description} with value {value}")
    except (TimeoutException, NoSuchElementException) as e:
        print(f"Could not locate or fill field {description}: {e}")

# 1. Fill visible input fields
personal = resume_data.get("personal_info", {})

# Email (input-6)
fill_input(By.ID, "input-6", personal.get("email", ""), "Email")

# Password (input-7) â€“ no password supplied, skip if not present
password = resume_data.get("password", "")
if password:
    fill_input(By.ID, "input-7", password, "Password")
else:
    print("Password not provided in resume_data; skipping password field.")

# Website / LinkedIn (e99fe97f-8c7b-450b-8369-7a7a5ee07271)
website_value = personal.get("linkedin", "")
fill_input(By.ID, "e99fe97f-8c7b-450b-8369-7a7a5ee07271", website_value, "Website/LinkedIn")

# 2. Upload resume PDF if file input exists
try:
    file_input = WebDriverWait(driver, 5).until(
        EC.presence_of_element_located((By.XPATH, "//input[@type='file']"))
    )
    file_input.send_keys(resume_pdf_path)
    print(f"Uploading resume PDF from {resume_pdf_path}")
except (TimeoutException, NoSuchElementException):
    print("No file input found for resume upload; skipping.")

# 3. Click Next / Continue / Save and Continue button (if present)
next_clicked = False
button_text_options = ["next", "continue", "save and continue"]

for txt in button_text_options:
    try:
        btn = WebDriverWait(driver, 5).until(
            EC.element_to_be_clickable(
                (By.XPATH,
                 f"//button[contains(translate(normalize-space(.), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'{txt}')]")
            )
        )
        btn.click()
        print(f"Clicked button containing text '{txt}'.")
        next_clicked = True
        break
    except (TimeoutException, NoSuchElementException):
        continue

if not next_clicked:
    print("No Next/Continue/Save and Continue button found; form filled without navigation.")