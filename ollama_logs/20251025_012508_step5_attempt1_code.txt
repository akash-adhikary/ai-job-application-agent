from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

wait = WebDriverWait(driver, 15)
clicked = False

# Primary: button with exact visible text "Sign In"
try:
    sign_in_btn = wait.until(
        EC.element_to_be_clickable((By.XPATH, "//button[normalize-space()='Sign In']"))
    )
    driver.execute_script(
        "arguments[0].scrollIntoView({block: 'center'});", sign_in_btn
    )
    time.sleep(1)
    try:
        sign_in_btn.click()
        print("✓ Clicked Sign In button (normal click)")
    except Exception:
        driver.execute_script("arguments[0].click();", sign_in_btn)
        print("✓ Clicked Sign In button (JS click)")
    clicked = True
except Exception as e:
    print(f"✗ Primary Sign In selector failed: {e}")

# Fallback: known CSS classes
if not clicked:
    for css_sel in ["button.css-wkqt22", "button.css-1ru62dj"]:
        try:
            btn = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, css_sel)))
            driver.execute_script(
                "arguments[0].scrollIntoView({block: 'center'});", btn
            )
            time.sleep(1)
            driver.execute_script("arguments[0].click();", btn)
            print(f"✓ Clicked Sign In using selector {css_sel}")
            clicked = True
            break
        except Exception as e:
            print(f"✗ Selector {css_sel} failed: {e}")

# Final generic fallback: any element containing the text
if not clicked:
    try:
        generic = wait.until(
            EC.element_to_be_clickable(
                (By.XPATH, "//*[contains(text(),'Sign In') and (self::button or self::a or self::div)]")
            )
        )
        driver.execute_script(
            "arguments[0].scrollIntoView({block: 'center'});", generic
        )
        time.sleep(1)
        driver.execute_script("arguments[0].click();", generic)
        print("✓ Clicked generic Sign In element (JS click)")
    except Exception as e:
        print(f"✗ All attempts to click Sign In failed: {e}")