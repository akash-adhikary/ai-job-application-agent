# Click the initial "Sign In" button
try:
    sign_in_btn = wait.until(
        EC.element_to_be_clickable((By.XPATH, "//button[contains(., 'Sign In')]"))
    )
    driver.execute_script("arguments[0].scrollIntoView(true);", sign_in_btn)
    sign_in_btn.click()
    print("Clicked Sign In button")
except Exception as e:
    print(f"Failed to click Sign In button: {e}")

# Fill email and password fields
try:
    email_input = wait.until(
        EC.visibility_of_element_located(
            (
                By.XPATH,
                "//input[contains(@type,'email') or contains(@name,'email') or contains(@id,'email') or contains(@placeholder,'Email')]",
            )
        )
    )
    driver.execute_script("arguments[0].scrollIntoView(true);", email_input)
    email_input.clear()
    email_input.send_keys(EMAIL)

    password_input = wait.until(
        EC.visibility_of_element_located(
            (
                By.XPATH,
                "//input[contains(@type,'password') or contains(@name,'password') or contains(@id,'password') or contains(@placeholder,'Password')]",
            )
        )
    )
    driver.execute_script("arguments[0].scrollIntoView(true);", password_input)
    password_input.clear()
    password_input.send_keys(PASSWORD)

    print("Entered email and password")
except Exception as e:
    print(f"Failed to fill credentials: {e}")

# Click the login/submit button
try:
    submit_btn = wait.until(
        EC.element_to_be_clickable(
            (
                By.XPATH,
                "//button["
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'sign in') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'login') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'next') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'continue') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'apply') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'submit') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'save') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'finish') or "
                "contains(translate(text(),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'confirm')"
                "]"
            )
        )
    )
    driver.execute_script("arguments[0].scrollIntoView(true);", submit_btn)
    submit_btn.click()
    print("Clicked login submit button")
except Exception as e:
    print(f"Failed to click login submit button: {e}")

# Wait for URL to change after login
try:
    old_url = driver.current_url
    wait.until(lambda d: d.current_url != old_url)
    print("URL changed after login")
except Exception as e:
    print(f"URL did not change after login: {e}")